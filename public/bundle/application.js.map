{"version":3,"sources":["app/ou3.js","app/controllers/data_controller.js","app/controllers/main_controller.js","app/factories/broox-map-factory.js","app/factories/placer-factory.js"],"names":["angular","module","constant","controller","$scope","placer","brooxMap","$window","mapLoaded","area","$on","e","data","extract","$apply","toggleMiniLock","console","log","$emit","handleUpdatePosition","arguments","Date","now","reload","location","then","map","handleGeoCode","length","$broadcast","navigator","geolocation","alert","geocoder","google","maps","Geocoder","mapCanvas","document","querySelector","this","miniLock","position","lat","lng","updatePosition","getCurrentPosition","LatLng","coords","latitude","longitude","updateMap","geocode","latLng","loadGoogle","initMap","factory","$q","googleLoaded","loadGoogleDefer","resolve","canvas","mapOptions","center","coordinates","zoom","disableDefaultUI","mapTypeControl","mapTypeControlOptions","style","MapTypeControlStyle","DROPDOWN_MENU","streetViewControl","streetViewControlOptions","ControlPosition","RIGHT_TOP","Map","mapLoadedDefer","setMarker","setCenter","currentMarker","setMap","Marker","animation","Animation","DROP","title","defer","event","addDomListener","promise","getMarker","getMap","LEVEL_CODES","typeGrep","level_codes","extractObj","i","n","item","$","grep","d","idx","types"],"mappings":"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","file":"application.js","sourcesContent":["angular.module('ou3', ['ngTouch', 'ngAnimate'])\n  .constant('LEVEL_CODES', [\n    'neighborhood',\n    'route',\n    'postal_code',\n    'postal_code_suffix',\n    'locality',\n    'sublocality_level_1',\n    'administrative_area_level_1',\n    'administrative_area_level_2'\n  ]);\n","angular.module('ou3')\n.controller('DataController', [\n  '$scope',\n  'placer',\n  'brooxMap',\n  '$window',\n  function ($scope, placer, brooxMap, $window) {\n  $scope.mapLoaded = false;\n  $scope.area = {};\n\n  $scope.$on('geocode', function (e, data) {\n    $scope.area = placer.extract(data);\n    $scope.$apply(); //i know i know i have to refactor this\n\n  });\n\n  $scope.toggleMiniLock = function () {\n    console.log(\"toggling\")\n    $scope.$emit('toggle_mini_lock');\n  };\n\n  $scope.handleUpdatePosition = function () {\n    console.log(\"handleUpdatePosition Called\", arguments, Date.now())\n    $scope.$emit('update_position')\n  };\n\n  $scope.reload = function () {\n    $window.location.reload();\n  };\n\n\n  brooxMap.mapLoaded.then(function (map) {\n    $scope.mapLoaded = true;\n  });\n\n}])\n","angular.module('ou3')\n.controller('MainController', [\n  '$scope',\n  '$window',\n  'brooxMap',\n  function ($scope, $window, brooxMap) {\n    //initial check\n    if (!$window.navigator.geolocation) {\n      alert(\"This isn't gonna work out :/\");\n    }\n\n    var geocoder = new brooxMap.google.maps.Geocoder();\n    var mapCanvas = document.querySelector('#map-canvas');\n\n    this.miniLock = false;\n    $scope.$on('toggle_mini_lock', function (e) {\n      $scope.miniLock = !$scope.miniLock;\n    });\n\n    this.position = {lat:40.216339, lng: -74.741427};  //default coords\n    $scope.updatePosition = function () {\n      $window.navigator.geolocation.getCurrentPosition(function (location) {\n        $scope.position = new brooxMap.LatLng(location.coords.latitude, location.coords.longitude);\n        brooxMap.updateMap($scope.position);\n        geocoder.geocode({'latLng': $scope.position}, handleGeoCode);\n      })\n    };\n\n    $scope.$on('update_position', $scope.updatePosition)\n\n    //make sure google service is loaded\n    brooxMap.loadGoogle.then(function () {\n      brooxMap.initMap(mapCanvas);\n      $scope.updatePosition();\n    });\n\n    function handleGeoCode (data) {\n      if (data.length && data[0]['address_components']) {\n        $scope.$broadcast('geocode', data[0]['address_components'])\n      }\n    }\n\n}])\n","angular.module('ou3')\n.factory('brooxMap', ['$q','$window', function ($q, $window) {\n  var google = $window.google;\n  var loadGoogleDefer = $q.defer();\n  var mapLoadedDefer = $q.defer();\n  var coordinates = {lat: 40.216339, lng: -74.741427};\n  var map = null;\n  var currentMarker = null;\n\n  google.maps.event.addDomListener($window, 'load', googleLoaded);\n\n  function googleLoaded () {\n    loadGoogleDefer.resolve(true);\n  }\n\n  function initMap (canvas) {\n    var mapOptions = {\n      center: coordinates, //new $g.maps.LatLng($scope.position.latitude, $scope.position.longitude),\n      zoom: 15,\n      disableDefaultUI: true,\n      mapTypeControl: true,\n      mapTypeControlOptions: {\n        style: google.maps.MapTypeControlStyle.DROPDOWN_MENU\n      },\n      streetViewControl:true,\n      streetViewControlOptions: {\n        position: google.maps.ControlPosition.RIGHT_TOP\n      }\n    };\n\n    map = new google.maps.Map(canvas, mapOptions);\n    mapLoadedDefer.resolve();\n    setMarker();\n\n    //return map;\n  }\n\n  function updateMap (coords) {\n    //console.log(\"Coords\", coords)\n    //if (!coordinates.hasOwnProperty('k')) {\n      //coordinates = new google.maps.LatLng(coords.latitude, coords.longitude)\n    //} else {\n      coordinates = coords;\n    //}\n\n\n    if(map) {\n      map.setCenter(coordinates);\n      setMarker();\n    }\n  };\n\n  function setMarker () {\n    if (currentMarker) {\n      currentMarker.setMap(null)\n    }\n\n    currentMarker = new google.maps.Marker({\n      position: coordinates,\n      map: map,\n      animation: google.maps.Animation.DROP,\n      title: \"You are Here\"\n    })\n  }\n\n  return {\n    loadGoogle: loadGoogleDefer.promise,\n    mapLoaded: mapLoadedDefer.promise,\n    google: google,\n    initMap: initMap,\n    updateMap: updateMap,\n    LatLng: google.maps.LatLng,\n    getMarker: function () { return currentMarker},\n    getMap: function () { return map}\n  }\n\n}]);\n","angular.module('ou3')\n.factory('placer', ['LEVEL_CODES', function (LEVEL_CODES) {\n  var extract = function (data) {\n    return typeGrep(data, LEVEL_CODES);\n  };\n\n  function typeGrep (data,level_codes) {\n    //need to figure out how to find what failed\n    var extractObj =  {};\n\n    for(var i = 0, n = level_codes.length; i < n; i++) {\n      var item = $.grep(data, function (d, idx) {\n        return d.types[0] == level_codes[i]\n      });\n      if (item.length) {\n        extractObj[level_codes[i]] = item[0]['long_name']\n      }\n    }\n\n    return extractObj;\n  }\n\n  return {\n    extract: extract\n  }\n\n}]);\n"],"sourceRoot":"/source/"}